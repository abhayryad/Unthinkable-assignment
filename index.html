<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Support - TechCorp</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        /* All your original CSS goes here */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .chat-container { width: 100%; max-width: 900px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); overflow: hidden; display: flex; flex-direction: column; height: 90vh; max-height: 700px; }
        .chat-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; text-align: center; }
        .chat-header h1 { font-size: 24px; margin-bottom: 5px; }
        .chat-header p { font-size: 14px; opacity: 0.9; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; background: #f8f9fa; }
        .message { display: flex; margin-bottom: 20px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.bot { justify-content: flex-start; }
        .message.user { justify-content: flex-end; }
        .message-content { max-width: 70%; padding: 15px 20px; border-radius: 18px; position: relative; }
        .message.bot .message-content { background: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); border-bottom-left-radius: 4px; }
        .message.user .message-content { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-bottom-right-radius: 4px; }
        .avatar { width: 35px; height: 35px; border-radius: 50%; margin: 0 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .message.bot .avatar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; order: -1; }
        .message.user .avatar { background: #e9ecef; color: #667eea; order: 1; }
        .suggestions-container { padding: 20px; background: white; border-top: 1px solid #e9ecef; }
        .suggestions-title { font-size: 14px; color: #6c757d; margin-bottom: 15px; font-weight: 600; }
        .suggestions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .suggestion-btn { padding: 12px 16px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; text-align: left; color: #495057; }
        .suggestion-btn:hover { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: transparent; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
        .input-container { padding: 20px; background: white; border-top: 1px solid #e9ecef; }
        .input-wrapper { display: flex; gap: 10px; align-items: center; }
        .chat-input { flex: 1; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 25px; font-size: 15px; outline: none; transition: border-color 0.3s ease; }
        .chat-input:focus { border-color: #667eea; }
        .send-btn { width: 50px; height: 50px; border-radius: 50%; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.3s ease; font-size: 24px; }
        .send-btn:hover { transform: scale(1.1); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .loading { display: flex; gap: 5px; padding: 10px 0; }
        .loading-dot { width: 8px; height: 8px; border-radius: 50%; background: #667eea; animation: bounce 1.4s infinite ease-in-out; }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .error-message { color: #dc3545; font-weight: 500; }
        .disclaimer { text-align: center; font-size: 12px; color: #6c757d; padding: 10px; background: #f8f9fa; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #667eea; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #764ba2; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Customer Support</h1>
            <p>How can we help you today?</p>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="avatar">ü§ñ</div>
                <div class="message-content">
                    <p>Hello! Welcome to TechCorp Support. I can help with orders, shipping, returns, products, and account issues. What do you need help with?</p>
                </div>
            </div>
        </div>
        <div class="suggestions-container" id="suggestionsContainer">
            <div class="suggestions-title">Quick Questions:</div>
            <div class="suggestions-grid">
                <button class="suggestion-btn" data-question="How do I track my order?">üì¶ Track My Order</button>
                <button class="suggestion-btn" data-question="What is your return policy?">üîÑ Return Policy</button>
                <button class="suggestion-btn" data-question="How can I contact customer service?">üìû Contact Support</button>
                <button class="suggestion-btn" data-question="Tell me about product warranty">üõ°Ô∏è Product Warranty</button>
                <button class="suggestion-btn" data-question="How do I reset my password?">üîë Reset Password</button>
                <button class="suggestion-btn" data-question="What payment methods do you accept?">üí≥ Payment Methods</button>
            </div>
        </div>
        <div class="input-container">
            <div class="input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask about orders, shipping, returns, products..." maxlength="200" />
                <button class="send-btn" id="sendBtn"><span class="material-symbols-rounded">send</span></button>
            </div>
        </div>
        <div class="disclaimer">
            Responses are AI-generated. For urgent matters, please contact our human support team.
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const suggestionBtns = document.querySelectorAll('.suggestion-btn');
        let isGenerating = false;

        const CUSTOMER_SUPPORT_TOPICS = ['order', 'shipping', 'delivery', 'track', 'return', 'refund', 'exchange', 'product', 'warranty', 'payment', 'account', 'password', 'login', 'customer service', 'contact', 'support', 'help', 'price', 'discount', 'cancel', 'modify', 'change', 'status', 'invoice', 'receipt', 'charge'];

        function isCustomerSupportQuestion(message) {
            const lowerMessage = message.toLowerCase();
            return CUSTOMER_SUPPORT_TOPICS.some(topic => lowerMessage.includes(topic));
        }

        function addMessage(content, isUser = false, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            messageDiv.innerHTML = `<div class="avatar">${isUser ? 'üë§' : 'ü§ñ'}</div><div class="message-content ${isError ? 'error-message' : ''}"><p>${content}</p></div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoadingMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.id = 'loadingMessage';
            messageDiv.innerHTML = `<div class="avatar">ü§ñ</div><div class="message-content"><div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div></div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoadingMessage() {
            const loadingMsg = document.getElementById('loadingMessage');
            if (loadingMsg) loadingMsg.remove();
        }

        async function sendMessage(message) {
            if (!message.trim() || isGenerating) return;

            const userMessage = message.trim();
            chatInput.value = '';

            if (!isCustomerSupportQuestion(userMessage)) {
                addMessage(userMessage, true);
                setTimeout(() => {
                    addMessage("I can only help with customer support topics. Please ask about orders, shipping, etc.", false, true);
                }, 500);
                return;
            }

            isGenerating = true;
            sendBtn.disabled = true;
            addMessage(userMessage, true);
            addLoadingMessage();

            const systemPrompt = `You are a professional customer support chatbot for TechCorp...`; // Your full prompt

            try {
                // SECURE: Call your own backend server, NOT Google's API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ systemPrompt, userMessage })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || "Network response was not ok");
                }

                const data = await response.json();
                removeLoadingMessage();
                addMessage(data.reply.replace(/\*\*/g, ''));

            } catch (error) {
                removeLoadingMessage();
                addMessage("Sorry, technical difficulties. Please contact support directly.", false, true);
                console.error('Error:', error);
            } finally {
                isGenerating = false;
                sendBtn.disabled = false;
            }
        }

        sendBtn.addEventListener('click', () => sendMessage(chatInput.value));
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage(chatInput.value);
        });
        suggestionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const question = btn.getAttribute('data-question');
                sendMessage(question);
            });
        });
    </script>
</body>
</html>